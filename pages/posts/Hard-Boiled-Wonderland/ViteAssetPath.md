---
title: 为什么vite打包后dist文件无法直接运行
author: OceanPresent
time: '2022-05-01'
lang: zh-CN
---
[[toc]]
# 为什么vite打包后dist文件无法直接运行

## 起因

当我们完成一个vue项目后，使用vite将其编译打包后生成dist文件。此时如果我们直接在浏览器中打开dist文件夹中的index.html文件，发现显示的只是一片白屏。我们都知道vue项目是不能直接在浏览器中打开的，所以我们才需要编译，可为什么编译后的文件依然不能在浏览器中运行呢？

## Issue回顾

对于一个再简单不过的helloworld的vue项目，我们将其打包后打开dist文件，打开控制台可以看到浏览器报错：

![](http://res.oceanpresent.art/blog/202205122325400.png)

这份错误是谷歌浏览器本身造成的的，谷歌浏览器会限制访问本地文件。Chrome 正在计划禁止从非安全网站发起的专用网络请求，目的是保护用户免受针对专用网络上的路由器和其他设备的跨站点请求伪造 (CSRF) 攻击：

- 从 Chrome 94 开始阻止来自不安全公共网站的私有网络请求。
- 在 Chrome 101 中结束的弃用试验。
- 在 Chrome 92 中引入一些 Chrome 策略，允许托管的 Chrome 部署永久绕过弃用。

简而言之，就是你在线部署的网站（以http协议开头的），现在都是无法正常访问本地的开启服务资源的。


那么如果我们在本地开启一个服务器，是不是就能访问了呢？

我们使用vscode的live server插件可以在本地申请端口启动一个服务器，打开之前的index.html文件

![](http://res.oceanpresent.art/blog/202205122325402.png)

很遗憾，结果依然不能正常运行，同时浏览器报出了别的错误，新的404错误主要是说找不到资源。我们查看http的申请记录

![](http://res.oceanpresent.art/blog/202205122325403.png)

可以看到申请的资源URL为/assets/xxx.js。但显然我们资源正确的地址应该是/dist/assets/xxx.js

## 为什么

这是因为vite打包静态资源的默认地址为'/'。这里需要注意'/'和'./'的区别。'/'表示根路径；而'./'表示相对路径。'/assets'表示根路径下有一个assets文件夹，'./assets'表示当前目录下有一个assets文件夹。

liveserver插件开启的本地服务器的根目录是当前工作区项目文件夹（即package.json,README.md等文件所在的目录），根目录下当然是没有assets文件夹的（因为/dist/assets才是正确的路径）

有的人可能会说为什么同样是在服务器上运行，部署到云服务器上就可以呢？那是因为在云服务器中index.html认为的根目录就是自己所在的路径，所以'/assets'和'./assets'指向的路径其实是一样的。

## 解决方法

### 方法一：

修改vite编译配置的静态资源放置路径，将默认的base:'/'修改为base:'./'。这样index.html就会去寻找同级目录下的assets文件夹

![](http://res.oceanpresent.art/blog/202205122334112.png)

### 方法二：

修改liveserver的插件配置，将本地服务器的根地址从默认的项目文件夹修改为'/dist'。

![](http://res.oceanpresent.art/blog/202205122333578.png)

这个方法并不是一个好的解决措施，因为修改的非常隐式，在别人的电脑上依然是打不开的，而且他们很难知道你是如何成功打开的。当然这个方法可以证明我们真正了解了该问题的原理。

